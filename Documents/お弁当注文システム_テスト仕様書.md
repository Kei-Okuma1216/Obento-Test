
# テスト仕様書

<details><summary>概要 </summary>

## 0. 概要 
- **システム名**: お弁当注文システム
- **作成日**: 2025-3-3 
- **作成者**: 大隈　慶
- **バージョン**: 1.0 

</details>

<details><summary>1. テストの目的と品質基準</summary>

## 1. テストの目的と品質方針

### 1.1 テストの目的
- テストとはアプリが開発者の想定した正常な動作を行うことを確認・保障することである。
- そのため、以下の品質基準を満たすかを確認する。

### 1.2 品質方針 
- ユーザー（発注者）と店舗（受注者が）の両方でできる限り停止しないシステムをめざず。
- セキュリティについてはユーザー情報と店舗の注文情報は特殊な方法を用いない限り漏洩しないようにする。
- そのために以下を確認（テスト）する
    - 機能要件として定義した各種機能が期待通りに動作すること
    - 非機能要件として定義した各種非機能が期待通りに動作すること（条件を満たすこと）
- 特に下記の非機能要件を重視
    - 可用性
    - 性能
    - セキュリティー
    - ユーザビリティ
    - ブラウザ対応確認

</details>



<details><summary>2 テスト用語</summary>

## 2 テスト用語

### 2.1 テスト関係者
- テストでは以下のメンバーが実施します。
#### 開発者
- テストを作る人です。テスターに指示する文書を作ります。
#### テスター
- テストを実施する人。文書をもとにテストを実施します。


### 2.2 テストで使用する用語(一部)
- テストでは以下の用語を使用します。
#### Webアプリ
- Web技術で作ったアプリケーションのこと
- 画面や動作ロジックはHTMLとJavaScriptとFastAPIで作っています。
- ユーザーデータ等はクラウドにあるデータベースに保存しています。
- モバイルアプリはiOSやAndroidしか動きませんが、WebアプリはWebブラウザが使える端末全てで動かすことができます。
#### API（エーピーアイ）
- アプリケーションインターフェースの意味
- Web技術を使ってアプリの機能を実現するため、Webページ単位で機能を呼び出しています。
#### TOPページ
- ユーザーが一番最初にアクセスするページ。ポータル。
### フロントエンドとバックエンド
- フロントエンドがWebアプリの画面でデータを呼び出す側のこと。クライアントともいう。バックエンドとはフロントエンドから呼び出される側でデータを表示するための裏方となるサーバーやクラウドのこと。サーバーサイドともいう。
### テストフェーズ
- テストをする段階のこと。
### リリース
- 公式にアプリを動かすこと。
### エビデンス
- テストに際して得られた証拠のこと。
- 入出力画面など。
### スクリプト
- 簡単なプログラムのこと
- テストを楽に実行するため、開発者もしくはテスターがつくる。
### テストの種類
#### 順番
- 以下の順にやります
1. 単体テスト
2. 結合テスト
3. システムテスト
4. 受け入れテスト
#### 単体テスト
- 機能・操作画面ごとに動作検証を行う。
#### 結合テスト
- その他の機能・システムと連動させ動作検証を行う。
#### システムテスト
- 運用を想定し、システム全体で動作検証を行う。
#### 受け入れテスト
- 要件定義書や仕様書通りにできているかチェックする。一般的には納品直前に行う。
#### リグレッション（退行）テスト
- アプリ修正後に前からあった機能が損なわれていないかをテストする事です。
### デグレ
- プログラムの修正で失敗して、機能が壊れること。
### ブラックボックステスト・ホワイトボックステスト
- テスト手法（技法）
#### ブラックボックステスト
- 画面操作だけでテストします。
- プログラムが外から見えない前提のテストです。
##### ブラックボックステストの種類
- 同値分割法
- 境界値分析
- デシジョンテーブル
- 状態遷移テスト
- 組合せテスト
#### ホワイトボックステスト
- アプリ内部のプログラムをテストします。
- 開発者のみがやります。テスターは今回やりません。
#### ホワイトボックステストの種類
- 制御フローテスト
- データフローテスト
#### 経験ベースのテスト
- 作った人の経験でテストします。
#### 経験ベースのテスト技法の主な種類
- エラー推測
- 探索的テスト
##### 参考
[テスト技法の種類とは？ソフトウェア開発に取り入れるポイントも解説](https://www.qbook.jp/column/1644.html)

### セッション
- クライアントのWebブラウザとサーバーが接続したときに、データを通信するために使うパイプみたいなもの。基本的にブラウザを落とすと消える。
### クッキー
- ブラウザに簡易的にデータを保存する機構
- 通常はブラウザを閉じたらデータも消滅する。
- 今回はログインを自動化するため、ユーザー情報の保存先として使っている。
- 有効期限を30日に設定してあるので、1か月データが残るようになっている。
- ブラウザ画面でF12キーを押して、アプリケーションタブに切り替えると表示できる。
### ロール
- ユーザーの役割に応じた種類のこと
- ４種類ある

### 2.3 テストで使用する書類の例
- テストでは以下の書類を使用します。
1. **テスト実施手順書（Test Execution Procedure）**  
   - テストをどのように実施するかを詳細に記載した手順書。
   - テストの手順、前提条件、期待結果などを明確に記述する。

2. **テスト仕様書（Test Specification）**  
   - どのようなテストケースを実施するのかを定義した文書。  
   - テストケースごとの入力値、期待結果、実施方法などが記載される。

3. **テスト指示書（Test Instructions）**  
   - テスト担当者に対して具体的なテスト実施の指示を与える書類。  
   - 期間、対象範囲、使用環境、注意点などが記載されることが多い。

4. **テスト手順書（Test Procedure）**  
   - テストを実施する際の詳細な手順を説明する文書。
   - 初心者でも迷わず実施できるよう、具体的な操作手順を記述する。

- どの書類を用意するかは、テストの規模や目的によりますが、実施者がスムーズにテストできるように **「テスト実施手順書」** や **「テスト指示書」** を作成するのが一般的です。

- テスターがテストを実施し、その結果を記録する書類は、一般的に以下のように呼ばれます。

5. **テスト結果報告書（Test Report）**  
   - テスト全体の結果をまとめた報告書。  
   - 実施したテストケースの成功・失敗状況、発生した不具合、考察、改善点などを記載します。

6. **テスト結果記録書（Test Result Record）**  
   - 実施したテストごとの結果を記録する書類。  
   - 各テストケースの実施状況（合格/不合格）、実行日時、担当者、不具合の有無などを記録します。

7. **テスト実施記録（Test Execution Log）**  
   - テストの実施履歴を詳細に記録する文書。  
   - 実施した手順や環境、異常が発生した際の状況などを記録します。

8. **テスト結果シート（Test Result Sheet）**  
   - テストケースごとの実施結果を表形式でまとめたもの。  
   - Excelなどで管理されることが多く、テストの進捗管理にも使われます。

9. **バグ報告書（Bug Report）**  
   - テスト中に発見された不具合を記録する文書。  
   - 不具合の発生条件、再現手順、影響範囲、スクリーンショットなどを記載します。

- 状況に応じて、**「テスト結果記録書」や「テスト結果シート」** に詳細なデータを記録し、最終的に**「テスト結果報告書」** にまとめて報告する形が一般的です。

- 今回は開発者が「テスト実施計画書」と「テスト指示書」を作り、テスターは「テスト指示書」をもとにテストを実施して、「テスト結果シート」と「バグ報告書」を作成します。
- 「バグ報告書」は、もしバグがある場合に作ります。

### 2.4 テストの実施方針・テストフロー
#### 2.4.1 実施方針
- テストは基本的に100％合格を目指します。
- テスターは一般のユーザーが使うと想定された動作を実施します。
- テスト結果は成功・失敗ともに記録します。
- 失敗した場合、その時の条件も同時に記録します。
- テスト時間に制限はありません。
- テスターはわからない場合は、全部開発者に聞いてもよいです。

#### 2.4.2 テストフロー
1. テスト計画
- テストでは開発者がテスト書類（計画書・仕様書・手順書等）を作ります。
2. テスト実施 
- そのテスト書類に書かれたテスト方法(テストシナリオ)をもとに、テスターはテストを実施します。
3. テスト記録（エビデンス取得）
- テスターはテスト実施に際し、エビデンス（テスト証跡）を取得して、テスト結果をテスト成果物（テスト結果報告書）に記録します。
4. プログラム修正
- テスト成果物をもとに、開発者はアプリのプログラムを修正します。
5. 再テスト実施
- アプリのプログラムを修正後、再テストを実施します。
6. 製品リリース
- 再テスト合格後に、アプリをリリースします。
</details>



<details><summary>3 テストの種類・目的・方法</summary>

### 3 テストの種類・目的・方法

#### 3.1 機能テスト
- 単体テストと結合テストを実施する。
##### 3.1.1. 単体テスト
###### 目的：
- アプリの機能(API単体)の動作確認をする。
###### 方法：
- アプリの機能をそれぞれ手入力でテストする。
- スクリプトをつくり自動化することも可能です（ただしプログラムを壊さない限りとユーザーの通常の使用から逸脱しない限り）。
###### 備考：
- こちらは開発プログラマがAPI実装時に実施するので省略する。

##### 3.1.2 結合テスト
###### 目的：
- フロントエンドとバックエンドが連携して、アプリ全体がシステムとして期待した動きをするかを確認する。
- アプリの動作に支障がないかをテストする。
- 開発・検証・運用の3段階において実施する。
- 開発はアプリをテストサーバー起動後に実施して、検証と運用はクラウドにデプロイ後に実施する予定です。
###### 範囲：
- システム全体
- クラウドの機能はテストしない
###### 方法：
- 単体テストを組み合わせて、実際の業務を想定してテストします。
###### 備考：
- ユーザービリティおよびデザイン面のチェックも併せて実施する。

##### 3.1.3 運用テスト
###### 目的：
- 実際にお店に使ってもらう直前にリハーサルのように実施するテストです。
###### 範囲：
- システム全体
- クラウドの機能もテストする可能性があります。
    - 例.データベースにテストデータなどスクリプトで流し込む場合等
###### 方法：
- 実際の現場でテストをします。
- 使ったデータは削除します。

#### 3.2 非機能テスト
##### 3.2.1 概要
###### 目的：
- アプリの機能以外をテストする。
###### 種類：
1. 可用性テスト
2. 性能テスト
3. セキュリティテスト
4. ユーザービリティ確認
5. ブラウザ対応確認
###### 実施タイミング：
- 上記テストは結合テスト時に同時に実施する。

##### 3.2.2 可用性テスト
###### 目的：
- クラウド上での稼働率を 99％ 以上であることを確認する。
- 99% とは 1年 = 365日 として、365日 * 24時間 * 60分 = 年間 525,600分 になるので、1％ は 5,256 を引いた、520,344分で 361.35日、年間 3.65日 停止することになります。
- ただし、週４日 お弁当の発注と受注ができればよいので、実際の稼働可能日は、365÷4/7　で 204日強 になります。結果は 0.5589で、実際の稼働率は 56％ になります。でもいいはずです。
###### 方法：
- 全機能を使用時に動作が停止しないかを確認する。
- 何もしてなくても動作が停止しないかも確認します。

##### 3.2.3 性能テスト
###### 目的：
- データが多い場合やアクセス多発時の影響を調べたり、速度低下に注意する。
###### 方法：
- 機能が動作する体感速度を計測する。
- データが多い場合やアクセス多発時の影響を調べたり、速度低下に注意する。
- あまりにも露骨に遅い場合は、エビデンスも取得して報告する。
- サーバー以外にネットワークが遅い場合もあるので、合わせてネットワークの情報も記録しておく。

##### 3.2.4 セキュリティテスト
###### 目的：
- 異常なログイン方法やアクセス方法により、パスワードの漏洩などシステム情報が盗まれたり、システム全体が破壊されることがあります。その対策としてテストをします。
###### 方法：
- 通常の動作以外のURLを入力してエラー画面が表示されるか？
######  例. 
- エラー画面が正常に表示できるか？
- おかしなURLを入力して、エラー画面に遷移するか？
- SQLインジェクションのテスト。ログイン画面で意図的にSQL文を入力する。
プレースホルダー機能が働いていればアプリがエラーになり終了するが、働いていない場合は、データベースのデータが消されるなど異常な動作が可能になる。

##### 3.2.5 ユーザービリティテスト
###### 目的：
- システムに対してユーザーが使いやすいか、見やすいか、わかりやすいか、引っかかるところはないか、デザインはどうかといったユーザー視点での主観的な不具合や障害を検出する。
######  例.
- この画面の〇〇の部分は文字が見づらい。
- この部分は文字が化ける。
- この部分は動作がおかしい。
- こんな動きはきもいよー。
- なんでもいいです。

##### 3.2.6 ブラウザ対応確認
###### 目的：
- Webアプリはブラウザで表示するので、さまざまなブラウザで正常にアプリ画面が表示できるかを確認する。
###### 方法：
- PCとスマホの組み合わせとブラウザの組み合わせをいろいろやって、ポータル画面表示を確認する。
######  例.
- PCでChromeで表示する。PCでEdgeで表示する。
- iPhoneでSafariで表示する。AndroidでChromeで表示する。
- 文字を拡大した場合、どうなるのか？文字がつぶれたりしないか？
- ブラウザのダークモードにした場合、どうなるのか？

##### 備考
- 負荷テストは省略します。
</details>



<details><summary>4 テスト内容</summary>

### 4.1 ユーザー紹介 
- このシステムを使用するユーザーは４種類である。
1. 通常のユーザー
    - 一般の注文者(user)、発注者
    - 個別にスマホを使ってお弁当を注文する
    - スマホでNFCタグを読み取りシステムにアクセスして、お弁当を注文する。
    - サーバーにIDとパスワードの登録がない場合は初めに新規登録をする。その後注文を確定する。すでにある場合はそのまま注文を確定する。
2. 会社代表ユーザー
    - 代表注文者(manager)、代表発注者
    - 会社単位で社内の注文を取りまとめ、店舗にお弁当を注文する。
    - ポータル画面より会社代表ユーザーでログインすると、専用の会社代表ユーザー画面に遷移する。その会社の本日の注文状況を確認後、注文をまとめてFAX送信をしたりする。
3. 店舗ユーザー
    - お弁当屋(shop-user)、受注者
    - ユーザー・会社代表ユーザーからの注文を確認・処理する。
    - ポータル画面より店舗ユーザーでログインすると、専用の店舗ユーザー画面に遷移する。本日の受注状況（全会社にわたる）を表示する。処理済の注文に対しては、チェックを入れることができる。
4. 管理者ユーザー
    - 管理者ユーザー(admin)、管理者
    - システムの管理・メンテを行う。
    - ポータル画面より管理者ユーザーでログインすると、専用の管理者ユーザー画面に遷移する。すべての機能・画面にアクセスできる。

### 4.2 アプリの仕様
#### スマホとNFCタグの関係
- スマホは注文者が注文する道具であり、
- スマホでNFCタグを読み取り、そのURLにアクセスすることで注文とする。
- 利用イメージとして、利用者が個人のスマホをNFCタグにかざすことで、NFCタグ内のメモリに記録された URLおよびアクション情報を利用者のスマホが読み取り、自動的に注文管理サーバ（仮）に注文を送信する。
- NFCタグは2種類のタグを用意する。
    - 注文タグ
        - 日替わり弁当の注文合計件数を１件追加する
    - キャンセルタグ
        - 注文合計件数から１件削除する。
- NFCのうち、”NFCタグとの連携機能（パッシブ方式）”を用いて注文を処理する。
- NFCタグ使用による注文の成功・失敗の結果は、それぞれ利用者のWeb画面で確認することができる。
- 注文結果は注文者のスマホのWebブラウザに以下のように表示する
    - 注文に成功した場合
        - 成功の旨の文面を表示する
        - 「あなたの注文を承りました」「〇月✕日　日替弁当 450円 1件」
    - 注文に失敗した場合
        - 失敗の旨の文面を表示する。
        - 「注文に失敗しました。もう一度注文を実行して下さい」
- 注文管理サーバの注文情報は、受注者側に配置してあるタブレット端末に表示する注文管理画面を確認することで現在の注文状況を確認することができる。
- 将来NFCタグ は用途の変更を可能とする。
    - 例 注文タグを１種類でなく、利用者人数分用意するなど。
#### 注文方法
- お弁当の注文方法には２種類ある。
- 個人が注文する方法（個別注文）と会社代表者がまとめて注文する方法（まとめ注文）の２種類である。
- 個別注文ではユーザーがスマホを用いて注文する。
- まとめ注文では会社代表者が会社全体の注文をまとめて注文する。
- 当社の場合は、注文は職業訓練指導員である脇坂さんに、昼休み終わり１３時前に連絡する。もしくは聞いてくるのに答えて予約とする。
#### 注文の時間的制約
- 基本的に注文は翌日の注文しかできない。
- 注文の締切は前日の14時まで。
#### 注文内容の制約
- 注文できる店舗は現在１店舗のみ。
- 品目は日替弁当の1種類のみ。
#### 注文キャンセルの方法
- 注文キャンセルは当日10時半まで電話すること。
- 注文キャンセル期限以降は、注文キャンセルができない
- 注文キャンセルの際は、キャンセル料として300円を後日徴収する。
- 配達当日10時半以降の場合は、キャンセル不可で450円かかる。



### 4.2 テスト内容

#### 4.2.1 ＮＦＣ読み込みからのポータル表示
   - スマホでNFCタグを読み込み、ポータル画面が表示するか？
   - パソコンとスマホで同じ動作をするか？
   - ブラウザの違いはどうか？
   - Cookieとしてデータが保存できているか？
   - ネットワークが不通の場合はどうなるのか？
   - クラウドが落ちている場合はどうなるのか？

#### 4.2.2 ポータルでのログイン処理
##### ロール別
   1. 一般ユーザー・注文者(user)　成功
   2. 一般ユーザー・注文者(user)　失敗
   3. 会社代表ユーザー・代表注文者(maanger)　成功
   4. 会社代表ユーザー・代表注文者(maanger)　失敗
   5. 店舗ユーザー(shopuser)　成功
   6. 店舗ユーザー(shopuser)　失敗
   7. 管理者ユーザー(admin)　成功
   8. 管理者ユーザー(admin)　失敗
#### 4.2.3 当日２回目注文の失敗
   9. 一般ユーザー(user)
    - 当日２回目ログインで、警告が表示されて注文できない。一般ユーザー(user)のみ当てはまる。
   10. 管理者ユーザー(admin)
    - 一般ユーザー(user)のCookieを消すことができるか？（未実装）
#### 4.2.4 注文可能曜日の設定　【未実装】
   - 曜日単位で設定する。
   - 注文可能曜日は、毎週月・火・水の3日に限られる。
   - 金・土 はカレンダーにメニューは載っているが販売していない。
   - 木曜は弁当がメニューは載っていないので、注文できない。
   - 休日を挟んだ場合は、休日翌日の注文しかできない。
   - 例　翌日水曜が休日の場合は、火曜日注文で木曜配達になる。
##### 補足：注文可能曜日を表にしたもの
| 曜日 | 日 | 月 | 火 | 水 | 木 | 金 | 土 |
|-------|-------|-------|-------|-------|-------|-------|-------|
| menu | ✕ | 〇 | 〇 | 〇 | ✕ | 〇 | ✕ |
| 注文 | ✕ | １ | ２ | ✕ | ✕ | ３ | ✕ |
| 配達 | ✕ | ３ | １ | ２ | ✕ | ✕ | ✕ |

#### 4.2.5 注文可能曜日の設定【未実装】
   - 曜日単位で設定する。



</details>

<details><summary>5 テストに含めないもの</summary>

### 5 テストに含めないもの
1. サーバ起動操作
    - 理由： 環境が変化するため
2. 当日２回目注文の失敗は、通常のユーザー(User)のみとする。
    - 理由： 注文は通常のユーザーのみだから。

</details>



<details><summary>6. リスク管理</summary>

## 6. リスク管理 
- プロジェクトに関連するリスクとその対応策を記載します。 
### 6.1 リスク対応
- 基本的に対応可能日は平日のみとする。土日祝日は対応しない。
</details>


<details><summary>7. スケジュール </summary>

## 7. スケジュール 

- 開発開始日: 2024-12-16 
- 開発終了日: YYYY-MM-DD 
- マイルストーン: マイルストーンの一覧 
1. 要件定義作成完了     2024-12-16
2. 暫定仕様書作成完了   2024-12-20
3. 仕様書レビュー       2024-12-20
4. 暫定仕様書修正完了   2024-12-20
5. 実装検証開始         2024-12-27 
6. 仕様書レビュー2回目  2024-12-28

</details>


<details><summary>99. 付録</summary>

## 99. 付録

- その他の参考資料や追加情報を記載します。
### 要件定義書ドラフト
https://chatgpt.com/share/675fa125-e804-800b-99cf-6820389efba2
### セキュリティ
[JWT認証の流れを理解する](https://qiita.com/asagohan2301/items/cef8bcb969fef9064a5c)

プロトタイプtestサイト
https://kei-okuma1216.github.io/Obento-Test/

</details>
<br>
以上
