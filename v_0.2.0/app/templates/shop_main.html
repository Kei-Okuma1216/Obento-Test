<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>店舗メイン画面</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      h1 {
        color: #2c3e50;
      }
      ul {
        background: #ecf0f1;
        list-style-type: square;
        padding: 0;
      }
      li {
        background: #ecf0f1;
        margin: 0px 0;
        padding: 0px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <a class="navbar-brand" href="/login">トップに戻る</a>
        <div class="collapse navbar-collapse">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="/clear">ログアウト</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    
    <!-- メインコンテンツ -->
    <div class="container mt-4">
      <h1>店舗注文一覧</h1>

      <!-- タブナビゲーション -->
      <ul class="nav nav-tabs" id="storeTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="info-tab" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab" aria-controls="info" aria-selected="true">情報</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="order-tab" data-bs-toggle="tab" data-bs-target="#order" type="button" role="tab" aria-controls="order" aria-selected="false">注文</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="json-tab" data-bs-toggle="tab" data-bs-target="#json" type="button" role="tab" aria-controls="json" aria-selected="false">注文情報取得</button>
        </li>
      </ul>

      <!-- タブコンテンツ -->
      <div class="tab-content" id="storeTabContent">
        <!-- 情報タブ -->
        <div class="tab-pane fade show active" id="info" role="tabpanel" aria-labelledby="info-tab">
          <h2 class="mt-3">備考</h2>
          <p>注文締切時刻：前日13時</p>
          <h3 class="mt-3">機能状況</h3>
          <div class="mb-3">
            <h4>実装済</h4>
            <ul class="list-group mb-3">
              <li class="list-group-item"><del>受注情報を集計</del></li>
              <li class="list-group-item"><del>注文キャンセル処理</del></li>
            </ul>
            <h4>未実装</h4>
            <ul class="list-group">
              <li class="list-group-item">所定の時刻にFAX送信する</li>
              <li class="list-group-item">注文ログ・キャンセルログの分析</li>
              <li class="list-group-item">ユーザごとのデバイス識別</li>
              <li class="list-group-item">注文確認メール送信</li>
            </ul>
          </div>
        </div>
        
        <!-- 注文タブ -->
        <div class="tab-pane fade" id="order" role="tabpanel" aria-labelledby="order-tab">
          <div class="mt-3 text-end">
            <!-- 保存ボタン -->
            <button id="save-changes-button" class="btn btn-primary mb-3">保存</button>
          </div>
          <div class="table-responsive">
            <!-- テーブルヘッダー（各カラムの幅を指定） -->
            <table class="table table-striped table-bordered mb-0">
              <thead class="table-light">
                <tr>
                  <th style="width:10%;">番号</th>
                  <th style="width:15%;">会社</th>
                  <th style="width:15%;">名前</th>
                  <th style="width:25%;">メニュー名</th>
                  <th style="width:10%;">注文数</th>
                  <th style="width:15%;">注文時刻</th>
                  <th style="width:10%;">キャンセル有無</th>
                </tr>
              </thead>
            </table>
            <!-- テーブルボディをスクロール可能な枠に -->
            <div style="max-height: 300px; overflow-y: auto;">
              <table class="table table-striped table-bordered mb-0">
                <tbody>
                  {% include 'table.html' %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- 注文情報取得タブ -->
        <div class="tab-pane fade" id="json" role="tabpanel" aria-labelledby="json-tab">
          <h2 class="mt-3">注文情報取得</h2>
          <h3>JSONで注文情報を取得する</h3>
          <p>例: /order_json?days_ago=-5</p>
          <!-- 日付入力用テキストボックス -->
          <div class="mb-3">
            <label for="daysAgoInput" class="form-label">日付 (days_ago):</label>
            <input type="text" id="daysAgoInput" value="-5" class="form-control w-auto d-inline-block">
          </div>
          <!-- JSON取得ボタン -->
          <button id="fetch-json-btn" class="btn btn-primary mb-3">JSON取得</button>
          <!-- JSON取得リンク（aタグ、クリック時に更新） -->
          <a id="jsonLink" href="https://192.168.3.19:8000/shops/me/order_json?days_ago=-5" target="_blank" class="btn btn-info mb-3">注文情報取得 (JSON rowデータ)</a>
          <!-- JSON表示エリア -->
          <pre id="jsonOutput" style="background-color: #f8f9fa; padding: 10px; max-height: 300px; overflow-y: auto;"></pre>
        </div>
      </div>
      
    </div>
    
    <!-- JavaScript: JSON取得処理とリンク更新 -->
    <script>
      // JSON取得ボタンの処理
      document.getElementById("fetch-json-btn").addEventListener("click", function(){
        var days = document.getElementById("daysAgoInput").value.trim();
        fetch("/shops/me/order_json?days_ago=" + encodeURIComponent(days))
          .then(response => response.json())
          .then(data => {
            document.getElementById("jsonOutput").textContent = JSON.stringify(data, null, 2);
          })
          .catch(error => {
            document.getElementById("jsonOutput").textContent = "エラー: " + error;
          });
        // リンクのhrefを更新
        document.getElementById("jsonLink").href = "https://192.168.3.19:8000/shops/me/order_json?days_ago=" + encodeURIComponent(days);
      });
      // クリック時にもリンクのhrefを更新（念のため）
      document.getElementById("jsonLink").addEventListener("click", function(){
        var days = document.getElementById("daysAgoInput").value.trim();
        this.href = "https://192.168.3.19:8000/shops/me/order_json?days_ago=" + encodeURIComponent(days);
      });
    </script>
  </body>
</html>
