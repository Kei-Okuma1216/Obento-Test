<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>会社代表メイン画面</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      h1 {
        color: #2c3e50;
      }
      ul {
        background: #ecf0f1;
        list-style-type: square;
        padding: 0;
      }
      li {
        background: #ecf0f1;
        margin: 0px 0;
        padding: 0px;
        border-radius: 4px;
      }
      /* 追加: 注文タブ内のテーブルセルのフォントサイズをshop_main.htmlに合わせる */
      #order table th,
      #order table td {
        font-size: 14px;
      }
      /* 固定フッターの初期状態は少し下に隠す */
      .fixed-footer {
        position: fixed;
        left: 0;
        right: 0;
        bottom: -10px; /* ※必要に応じて調整 */
        transition: bottom 0.3s ease;
        z-index: 1030;
      }
      /* ホバー時にフッターを完全に表示 */
      .fixed-footer:hover {
        bottom: 0;
      }
      /* コンテンツ部分に下余白を追加（フッターの高さ分を確保） */
      .content-wrapper {
        padding-bottom: 80px; /* ※フッターの高さに合わせて調整 */
      }
      @media (max-width: 576px) { /* スマホサイズ（576px以下）の場合 */
        .fixed-footer { /* footer のクラス名を指定 */
            display: none;
        }
        .table-responsive {
          overflow-x: auto; /* 横スクロールを許可 */
        }
        .table-responsive table {
          min-width: 220%; /* テーブル幅を画面の2倍に設定 */
        }
      }
    </style>
  </head>
  <body>
    <!-- ヘッダー -->
    {% include 'components/header.html' %}

    <!-- メインコンテンツ -->
    <div class="container mt-4 content-wrapper">
      <div class="container mt-4">
        <h1>顧客担当者注文一覧</h1>
        <p class="mb-3">この画面は会社でお弁当をまとめて注文する場合に使用します。</p>

        <!-- タブナビゲーション -->
        <ul class="nav nav-tabs" id="managerTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="info-tab" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab" aria-controls="info" aria-selected="true">情報</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="order-tab" data-bs-toggle="tab" data-bs-target="#order" type="button" role="tab" aria-controls="order" aria-selected="false">注文一覧</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="fax-tab" data-bs-toggle="tab" data-bs-target="#fax" type="button" role="tab" aria-controls="fax" aria-selected="false">FAX送信</button>
          </li>
        </ul>

        <!-- タブコンテンツ -->
        <div class="tab-content" id="managerTabContent">
          <!-- 情報タブ -->
          <div class="tab-pane fade show active" id="info" role="tabpanel" aria-labelledby="info-tab">
            <h2 class="mt-3"></h2>
            <h3>機能状況</h3>
            <div class="mb-3">
              <h4>実装済</h4>
              <ul class="list-group mb-3">
                <li class="list-group-item"><del>注文確認</del></li>
                <li class="list-group-item"><del>受注情報を集計</del></li>
              </ul>
              <h4>未実装</h4>
              <ul class="list-group">
                <li class="list-group-item">注文ログ・キャンセルログ</li>
                <li class="list-group-item">所定の時刻（前日13時）にFAX送信する</li>
                <li class="list-group-item">ユーザごとのデバイス識別</li>
              </ul>
            </div>
          </div>

          <!-- 注文タブ -->
          <div class="tab-pane fade" id="order" role="tabpanel" aria-labelledby="order-tab">
            <div class="table-responsive mt-3">
              <div class="table-responsive mt-3 position-relative">
                <!-- テーブルヘッダー -->
                <!-- テーブルボディ部分（スクロール可能） -->
                <div style="max-height: 300px; overflow-y: auto;">
                  <table class="table table-striped table-bordered mb-0">
                    <tbody>
                      <!-- 注文データをここに挿入 -->
                      {% include 'order_table.html' %}
                    </tbody>
                  </table>
                </div>
              </div>  
            </div>
          </div>

          <!-- FAX送信タブ -->
          <div class="tab-pane fade" id="fax" role="tabpanel" aria-labelledby="fax-tab">
            <!-- 印刷ボタンのコンテナ（Flexboxで右寄せ） -->
            <div class="d-flex justify-content-end align-items-center mb-3">
              <button type="button" class="btn btn-secondary" onclick="openFaxOrderSheet()">FAX印刷</button>
              <!--<button type="button" class="btn btn-secondary" onclick="window.print()">印刷</button>-->
            </div>
            <div class="mb-3">
              <p>13時締め集計後のFAX送信</p>
              <!-- １．店名 -->
              <div class="form-group mb-2">
                <label style="margin-right: 10px;">店名：</label>
                <span>{{shop_name}}</span>
              </div>
              <!-- ２．メニュー選択リストボックス -->
              <div class="form-group mb-2">
                <label style="margin-right: 10px;">メニュー：</label>
                <select id="fax-menu">
                  <option>{{menu_name}}</option>
                </select>
              </div>
              <!-- ３．値段 -->
              <div class="form-group mb-2">
                <label style="margin-right: 10px;">値段：</label>
                <span>{{price}}円</span>
              </div>
              <!-- ４．個数指定 -->
              <div class="form-group mb-2">
                <label style="margin-right: 10px;">個数：</label>
                <input type="number" id="bento-count" name="bento_count" min="0" value="0" style="width:40px;"> 個
              </div>
              <!-- ５．合計金額（個数×450円） -->
              <div class="form-group mb-2">
                <label style="margin-right: 10px;">合計金額：</label>
                <input type="text" id="total-amount" name="total_amount" value="0 円" readonly>
              </div>
            </div>
          </div>

        </div>
      </div>    
    </div>

    <!-- フッター -->
    {% include 'components/footer.html' %}
  </body>
  <script>
    // Jinja2 の変数を用いて、faxContext オブジェクトに値を埋め込みます
    const faxContext = {
        shop_name: "{{ shop_name }}",
        menu_name: "{{ menu_name }}",
        price: "{{ price }}",
        order_count: "{{ order_count }}",
        total_amount: "{{ total_amount }}",
        facility_name: "{{ facility_name }}",
        POC: "{{ POC }}"
    };
  
    function openFaxOrderSheet() {
        // 絶対パスで新しく作成したエンドポイントにアクセス
        const base_url = "https://192.168.3.19:8000"
        const url = base_url + "/manager/me/fax_order_sheet";
        window.open(url, "_blank");
    }
    // 1個あたりの価格
    const pricePerBento = 450;
    
    // 個数入力欄の変更時に合計金額を更新する関数
    function updateTotal() {
      let count = parseInt(document.getElementById('bento-count').value, 10) || 0;
      let total = count * pricePerBento;
      // 個数が0の場合は「0円」、それ以外はtoLocaleStringでカンマ区切り
      let formattedTotal = total === 0 ? "0" : total.toLocaleString();
      document.getElementById('total-amount').value = formattedTotal + " 円";
    }
  
  // 個数入力欄での直接入力時に更新
  document.getElementById('bento-count').addEventListener('input', updateTotal);
  </script>

  </html>
